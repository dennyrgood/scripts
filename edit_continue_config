#!/bin/zsh

# Define the original file path
ORIGINAL_FILE="$HOME/.continue/config.yaml"

# Define the backup directory (e.g., in the same directory as the file)
BACKUP_DIR="${ORIGINAL_FILE:h}/backups"

# Get the current timestamp in YYYYMMDD_HHMMSS format
TIMESTAMP=$(date +"%Y%m%d_%H%M%S")

# Define the backup file path
BACKUP_FILE="$BACKUP_DIR/config.yaml.bak_$TIMESTAMP"

# --- Main Logic ---

echo "Starting backup and edit process..."

# 1. Check if the original file exists
if [ ! -f "$ORIGINAL_FILE" ]; then
    echo "Error: Original file not found at $ORIGINAL_FILE"
    exit 1
fi

# 2. Ensure the backup directory exists
mkdir -p "$BACKUP_DIR"

# 3. Create the time-stamped backup
cp "$ORIGINAL_FILE" "$BACKUP_FILE"

if [ $? -eq 0 ]; then
    echo "✅ Successfully created backup: $BACKUP_FILE"
else
    echo "❌ Error during backup creation. Aborting."
    exit 1
fi

# 4. Open the original file for editing
echo "Launching vi to edit $ORIGINAL_FILE..."
vi "$ORIGINAL_FILE"

echo "Editing complete."
echo "---"
echo "To restore the backup, you can use: cp $BACKUP_FILE $ORIGINAL_FILE"

# The script exits after vi is closed
